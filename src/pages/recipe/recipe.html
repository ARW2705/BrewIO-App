<app-header [title]="title"></app-header>

<ion-content class="content">

  <ion-grid>

    <ng-container *ngIf="isLoggedIn">
      <ion-row class="messages-header">
        <h3>Active Batches</h3>
      </ion-row>
      <active-batches></active-batches>
    </ng-container>

    <ion-row justify-content-center>
      <button ion-button
              (click)="navToRecipeForm()"
              id="create-button">
        Create New Recipe Master
      </button>
    </ion-row>

    <ion-row *ngIf="masterList">
      <ion-list id="master-list">
        <ng-container *ngFor="let master of masterList; index as i">
          <ion-item-sliding class="recipe-master-item">

            <ion-item-options side="left">
              <button ion-button
                      color="danger"
                      (click)="deleteMaster(master)">
                <ion-icon name="trash"></ion-icon>
                Delete
              </button>
            </ion-item-options>

            <button detail-none
                    class="expand-button"
                    (click)="expandMaster(i)"
                    ion-item
                    lines="none">
              <ion-grid no-padding>
                <ion-row class="master-summary-header">
                  <ion-col>
                    {{ master.name }}
                  </ion-col>
                  <ion-col>
                    • {{ master.style.name }}
                  </ion-col>
                </ion-row>
                <ion-row class="master-summary-subheader">
                  <ion-col>
                    <p>
                      {{ masterRecipeList[i].batchVolume }} gal
                       • {{ masterRecipeList[i].brewingType | titlecase }}
                       • {{ masterRecipeList[i].ABV.toFixed(1) }}% ABV
                       • {{ masterRecipeList[i].IBU.toFixed(1) }} IBU
                       • {{ masterRecipeList[i].SRM.toFixed(1) }} SRM
                    </p>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </button>

            <ion-item-options side="right">
              <button ion-button
                      color="primary"
                      (click)="navToBrewProcess(master)">
                <ion-icon name="beer"></ion-icon>
                Brew
              </button>
              <button ion-button
                      color="secondary"
                      (click)="navToDetails(i)">
                <ion-icon name="menu"></ion-icon>
                Details
              </button>
            </ion-item-options>

          </ion-item-sliding>
          <accordion [expanded]="showExpandedMaster(i)">
            <ion-card class="recipe-card">
              <ion-card-content>
                <ion-list *ngIf="masterRecipeList[i]">
                  <ion-item-group *ngIf="masterRecipeList[i].grains.length">
                    <ion-item-divider color="primary" class="card-divider">
                      Grains
                    </ion-item-divider>
                    <ion-grid>
                      <ion-row  *ngFor="let grains of masterRecipeList[i].grains"
                                justify-content-between
                                align-items-center
                                class="ingredient-row">
                        <ion-col col-7>
                          {{ grains.grainType.name }}
                        </ion-col>
                        <ion-col col-4>
                          {{ grains.quantity }} lbs
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item-group>
                  <ion-item-group *ngIf="masterRecipeList[i].hops.length">
                    <ion-item-divider color="primary" class="card-divider">
                      Hops
                    </ion-item-divider>
                    <ion-grid>
                      <ion-row  *ngFor="let hops of masterRecipeList[i].hops"
                                justify-content-between
                                align-items-center
                                class="ingredient-row">
                        <ion-col col-7>
                          {{ hops.hopsType.name }}
                        </ion-col>
                        <ion-col col-4>
                          {{ hops.quantity }} oz
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item-group>
                  <ion-item-group *ngIf="masterRecipeList[i].yeast.length">
                    <ion-item-divider color="primary" class="card-divider">
                      Yeast
                    </ion-item-divider>
                    <ion-grid>
                      <ion-row  *ngFor="let yeast of masterRecipeList[i].yeast"
                                justify-content-between
                                align-items-center
                                class="ingredient-row">
                        <ion-col col-7>
                          {{ yeast.yeastType.name }}
                        </ion-col>
                        <ion-col col-4>
                          {{ yeast.quantity }} pack
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item-group>
                  <ion-item-group *ngIf="masterRecipeList[i].otherIngredients.length">
                    <ion-item-divider color="primary" class="card-divider">
                      Other Ingredients
                    </ion-item-divider>
                    <ion-grid>
                      <ion-row  *ngFor="let other of masterRecipeList[i].otherIngredients"
                                justify-content-between
                                class="ingredient-row">>
                        <ion-col col-7>
                          {{ other.name }}
                        </ion-col>
                        <ion-col col-4>
                          {{ other.type }}
                        </ion-col>
                        <ion-col col-12>
                          {{ other.description }}
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item-group>
                </ion-list>
              </ion-card-content>
            </ion-card>
          </accordion>
        </ng-container>
      </ion-list>
    </ion-row>

    <ion-row *ngIf="errMsg">
      <ion-col>
        {{ errMsg }}
      </ion-col>
    </ion-row>

    <ion-row *ngIf="isLoggedIn && !masterList">
      <ion-spinner color="primary"></ion-spinner>
    </ion-row>

  </ion-grid>

</ion-content>
